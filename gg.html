<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Risk Assessment Form</title>
    <style>
        /* Base styles for the document */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font for a modern look */
            font-size: 10pt;
            line-height: 1.4;
            color: #333;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa; /* Light background for better contrast */
        }

        /* Print-specific styles */
        @page {
            size: A4; /* Standard A4 page size */
            margin: 0.75in; /* Consistent margins for printing */
        }

        /* Ensure elements break cleanly across pages */
        .section {
            margin-bottom: 25px;
            page-break-inside: avoid; /* Prevent sections from breaking in half */
        }

        /* Header styling */
        .header {
            text-align: center;
            border-bottom: 3px solid #2c5aa0; /* Stronger blue line */
            padding-bottom: 20px;
            margin-bottom: 30px;
            background-color: #ffffff; /* White background for header */
            padding-top: 20px;
        }

        .header h1 {
            color: #2c5aa0;
            font-size: 26pt; /* Slightly larger heading */
            margin: 0;
            font-weight: bold;
            text-transform: uppercase; /* Uppercase for emphasis */
        }

        .header .subtitle {
            color: #666;
            font-size: 13pt; /* Slightly larger subtitle */
            margin-top: 8px;
        }

        /* Section headings */
        .section h2 {
            background: #2c5aa0;
            color: white;
            padding: 10px 15px; /* More padding */
            margin: 0 0 20px 0; /* More margin below */
            font-size: 16pt; /* Larger section title */
            font-weight: bold;
            border-radius: 5px; /* Rounded corners for section headers */
        }

        /* Sub-section headings */
        .section h3 {
            color: #2c5aa0;
            font-size: 13pt; /* Slightly larger sub-heading */
            margin: 25px 0 10px 0; /* More spacing */
            font-weight: bold;
            border-bottom: 1px solid #a0c0e0; /* Lighter, more subtle border */
            padding-bottom: 5px;
        }

        /* Form row layout */
        .form-row {
            margin-bottom: 15px; /* Increased spacing between rows */
            display: flex;
            flex-wrap: wrap;
            align-items: baseline; /* Align labels and inputs better */
        }

        .form-row label {
            font-weight: bold;
            margin-right: 15px; /* More space after labels */
            min-width: 150px; /* Wider minimum width for labels */
            flex-shrink: 0; /* Prevent labels from shrinking */
        }

        /* Input field styling */
        .form-row input[type="text"],
        .form-row input[type="date"] {
            border: none;
            border-bottom: 1px dashed #666; /* Dashed line for input fields */
            padding: 4px 2px; /* More padding */
            margin-right: 20px; /* More space between inputs */
            min-width: 180px; /* Wider input fields */
            background: transparent;
            flex-grow: 1; /* Allow inputs to grow */
        }

        /* Checkbox group layout */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px; /* Increased gap for better spacing */
            margin-top: 8px;
            align-items: center;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px; /* Space between checkbox and label */
        }

        .checkbox-item input[type="checkbox"] {
            width: 14px; /* Larger checkboxes */
            height: 14px;
            border: 1px solid #2c5aa0; /* Blue border for checkboxes */
            border-radius: 3px; /* Slightly rounded checkboxes */
        }

        .checkbox-item label {
            font-weight: normal; /* Labels for checkboxes are not bold */
            margin-right: 0; /* Remove extra margin */
            min-width: unset; /* Remove min-width for checkbox labels */
        }

        /* Table styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0; /* More margin around tables */
            font-size: 9.5pt; /* Slightly larger font in tables */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Subtle shadow for tables */
            border-radius: 8px; /* Rounded corners for tables */
            overflow: hidden; /* Ensures rounded corners are visible */
        }

        table th {
            background: #e9ecef; /* Lighter header background */
            border: 1px solid #dee2e6; /* Lighter border */
            padding: 10px; /* More padding */
            text-align: left;
            font-weight: bold;
            color: #2c5aa0; /* Blue header text */
        }

        table td {
            border: 1px solid #dee2e6; /* Lighter border */
            padding: 10px;
            vertical-align: top;
        }

        /* Risk matrix styling (if applicable) */
        .risk-matrix {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 3px; /* Slightly more gap */
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
        }

        .risk-cell {
            padding: 10px; /* More padding */
            text-align: center;
            font-weight: bold;
            color: white;
            border-radius: 3px; /* Small border-radius for cells */
        }

        .risk-low { background: #28a745; } /* Green */
        .risk-medium { background: #ffc107; color: #333; } /* Yellow */
        .risk-high { background: #fd7e14; } /* Orange */
        .risk-critical { background: #dc3545; } /* Red */

        /* Signature section styling */
        .signature-section {
            margin-top: 40px; /* More space above signatures */
            display: grid;
            grid-template-columns: 1fr 1fr; /* Two columns */
            gap: 30px; /* More space between signature boxes */
        }

        .signature-box {
            border: 1px solid #a0c0e0; /* Lighter border */
            padding: 20px; /* More padding */
            min-height: 80px; /* Taller boxes */
            border-radius: 8px; /* Rounded corners */
            background-color: #ffffff; /* White background */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Subtle shadow */
        }

        .signature-box .name {
            font-weight: bold;
            border-bottom: 1px dashed #666; /* Dashed line for name */
            padding-bottom: 5px;
            margin-bottom: 15px; /* More space below name */
            font-size: 11pt;
        }

        .signature-box .date {
            margin-top: 25px; /* More space above date */
            font-size: 9pt;
            color: #555;
        }

        /* Page break for printing */
        .page-break {
            page-break-before: always; /* Force a new page */
        }

        /* Footer styling */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 8pt;
            color: #666;
            border-top: 1px solid #ddd;
            padding-top: 8px;
            padding-bottom: 8px;
            background-color: #ffffff;
        }

        /* New styles for LLM integration */
        .llm-button {
            background-color: #2c5aa0;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 10pt;
            margin-left: 10px;
            transition: background-color 0.3s ease;
        }

        .llm-button:hover {
            background-color: #3b7bbd;
        }

        .llm-response {
            margin-top: 10px;
            padding: 10px;
            border: 1px dashed #a0c0e0;
            border-radius: 5px;
            background-color: #eaf2f8;
            font-size: 9pt;
            color: #555;
            min-height: 30px; /* Ensure space for response */
        }

        .loading-indicator {
            display: inline-block;
            margin-left: 10px;
            font-style: italic;
            color: #888;
        }

        /* Hide elements not needed for print */
        @media print {
            body {
                font-size: 9pt; /* Slightly smaller font for print */
                -webkit-print-color-adjust: exact; /* Ensure background colors are printed */
                color-adjust: exact;
            }
            .section {
                page-break-inside: avoid; /* Keep sections together */
            }
            .no-print {
                display: none; /* Hide footer and other non-print elements */
            }
            input[type="text"], input[type="date"] {
                border-bottom: 1px dashed #333 !important; /* Ensure dashed line prints */
            }
            /* Adjust margins for printing */
            .header, .section, .footer {
                margin-left: 0.75in;
                margin-right: 0.75in;
                width: auto; /* Allow content to fill print width */
            }
            .llm-button, .llm-response, .loading-indicator {
                display: none; /* Hide LLM features when printing */
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>IT Risk Assessment Form</h1>
        <div class="subtitle">Enterprise Risk Management | Information Technology</div>
    </div>

    <div class="section">
        <h2>Section 1: Assessment Overview</h2>
        <div class="form-row">
            <label>Assessment ID:</label>
            <input type="text" id="assessmentId" style="width: 120px;">
            <label>Assessment Date:</label>
            <input type="date" id="assessmentDate">
            <label>Next Review Date:</label>
            <input type="date" id="nextReviewDate">
        </div>

        <div class="form-row">
            <label>Assessment Type:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="initial">
                    <label for="initial">Initial</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="periodic">
                    <label for="periodic">Periodic</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="incident">
                    <label for="incident">Incident-driven</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="regulatory">
                    <label for="regulatory">Regulatory</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="postimpl">
                    <label for="postimpl">Post-implementation</label>
                </div>
            </div>
        </div>

        <h3>Assessment Team</h3>
        <div class="form-row">
            <label>Lead Assessor:</label>
            <input type="text" id="leadAssessor" style="width: 200px;">
            <label>Department:</label>
            <input type="text" id="assessorDept" style="width: 200px;">
            <label>Contact:</label>
            <input type="text" id="assessorContact" style="width: 200px;">
        </div>

        <table>
            <tr>
                <th>Role</th>
                <th>Name</th>
                <th>Department</th>
                <th>Contact</th>
            </tr>
            <tr>
                <td>Risk Manager</td>
                <td><input type="text" class="team-name"></td>
                <td><input type="text" class="team-dept"></td>
                <td><input type="text" class="team-contact"></td>
            </tr>
            <tr>
                <td>IT Security Officer</td>
                <td><input type="text" class="team-name"></td>
                <td><input type="text" class="team-dept"></td>
                <td><input type="text" class="team-contact"></td>
            </tr>
            <tr>
                <td>Business Unit Representative</td>
                <td><input type="text" class="team-name"></td>
                <td><input type="text" class="team-dept"></td>
                <td><input type="text" class="team-contact"></td>
            </tr>
            <tr>
                <td>Compliance Officer</td>
                <td><input type="text" class="team-name"></td>
                <td><input type="text" class="team-dept"></td>
                <td><input type="text" class="team-contact"></td>
            </tr>
        </table>

        <h3>Assessment Scope</h3>
        <div class="form-row">
            <label>Business Unit/Department:</label>
            <input type="text" id="businessUnit" style="width: 250px;">
        </div>
        <div class="form-row">
            <label>System/Application:</label>
            <input type="text" id="systemApp" style="width: 250px;">
        </div>
        <div class="form-row">
            <label>Infrastructure Component:</label>
            <input type="text" id="infraComponent" style="width: 250px;">
        </div>
        <div class="form-row">
            <label>Geographic Location:</label>
            <input type="text" id="geoLocation" style="width: 250px;">
        </div>
        <div class="form-row">
            <label>Assessment Period:</label>
            <input type="date" id="assessmentPeriodStart"> to <input type="date" id="assessmentPeriodEnd">
        </div>
    </div>

    <div class="section">
        <h2>Section 2: Asset Information</h2>

        <h3>Asset Classification</h3>
        <div class="form-row">
            <label>Asset Name:</label>
            <input type="text" id="assetName" style="width: 300px;">
        </div>
        <div class="form-row">
            <label>Asset Type:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="hardware">
                    <label for="hardware">Hardware</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="software">
                    <label for="software">Software</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="data">
                    <label for="data">Data</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="network">
                    <label for="network">Network</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="facility">
                    <label for="facility">Facility</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="personnel">
                    <label for="personnel">Personnel</label>
                </div>
            </div>
        </div>

        <div class="form-row">
            <label>Asset Owner:</label>
            <input type="text" id="assetOwner" style="width: 200px;">
            <label>Asset Custodian:</label>
            <input type="text" id="assetCustodian" style="width: 200px;">
        </div>

        <div class="form-row">
            <label>Business Criticality:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="critical">
                    <label for="critical">Critical</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="high">
                    <label for="high">High</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="medium">
                    <label for="medium">Medium</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="low">
                    <label for="low">Low</label>
                </div>
            </div>
        </div>

        <h3>Data Classification</h3>
        <div class="checkbox-group">
            <div class="checkbox-item">
                <input type="checkbox" id="public">
                <label for="public">Public</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="internal">
                <label for="internal">Internal Use Only</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="confidential">
                <label for="confidential">Confidential</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="restricted">
                <label for="restricted">Restricted/Classified</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="pii">
                <label for="pii">Personal Data (PII)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="financial">
                <label for="financial">Financial Data</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="healthcare">
                <label for="healthcare">Healthcare Data (PHI)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="ip">
                <label for="ip">Intellectual Property</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="customer">
                <label for="customer">Customer Data</label>
            </div>
        </div>

        <div class="form-row">
            <label>Data Volume:</label>
            <input type="text" id="dataVolume" style="width: 150px;">
            <label>Data Retention Requirements:</label>
            <input type="text" id="dataRetention" style="width: 200px;">
        </div>
    </div>

    <div class="section page-break">
        <h2>Section 3: Threat Assessment</h2>
        <p><strong>Instructions:</strong> Rate the likelihood for each threat category: 1-Very Low, 2-Low, 3-Medium, 4-High, 5-Very High</p>

        <table>
            <tr>
                <th style="width: 40%;">Threat Category</th>
                <th style="width: 15%;">Likelihood (1-5)</th>
                <th style="width: 45%;">Description/Notes</th>
            </tr>
            <tr>
                <td><strong>Cyber Attacks</strong></td>
                <td><input type="text" class="threat-likelihood" data-category="Cyber Attacks"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Malware/Ransomware</td>
                <td><input type="text" class="threat-likelihood" data-category="Malware/Ransomware"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Phishing/Social Engineering</td>
                <td><input type="text" class="threat-likelihood" data-category="Phishing/Social Engineering"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Advanced Persistent Threats</td>
                <td><input type="text" class="threat-likelihood" data-category="Advanced Persistent Threats"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Distributed Denial of Service</td>
                <td><input type="text" class="threat-likelihood" data-category="Distributed Denial of Service"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Zero-day Exploits</td>
                <td><input type="text" class="threat-likelihood" data-category="Zero-day Exploits"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td><strong>Insider Threats</strong></td>
                <td><input type="text" class="threat-likelihood" data-category="Insider Threats"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Malicious Insiders</td>
                <td><input type="text" class="threat-likelihood" data-category="Malicious Insiders"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Negligent Employees</td>
                <td><input type="text" class="threat-likelihood" data-category="Negligent Employees"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Privileged User Abuse</td>
                <td><input type="text" class="threat-likelihood" data-category="Privileged User Abuse"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Contractor/Third-party</td>
                <td><input type="text" class="threat-likelihood" data-category="Contactor/Third-party"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td><strong>Technical Failures</strong></td>
                <td><input type="text" class="threat-likelihood" data-category="Technical Failures"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Hardware Failure</td>
                <td><input type="text" class="threat-likelihood" data-category="Hardware Failure"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Software Bugs/Glitches</td>
                <td><input type="text" class="threat-likelihood" data-category="Software Bugs/Glitches"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Network Outages</td>
                <td><input type="text" class="threat-likelihood" data-category="Network Outages"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Database Corruption</td>
                <td><input type="text" class="threat-likelihood" data-category="Database Corruption"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Backup/Recovery Failure</td>
                <td><input type="text" class="threat-likelihood" data-category="Backup/Recovery Failure"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td><strong>Natural Disasters</strong></td>
                <td><input type="text" class="threat-likelihood" data-category="Natural Disasters"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Fire/Flood/Earthquake</td>
                <td><input type="text" class="threat-likelihood" data-category="Fire/Flood/Earthquake"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Power Outages</td>
                <td><input type="text" class="threat-likelihood" data-category="Power Outages"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Environmental Hazards</td>
                <td><input type="text" class="threat-likelihood" data-category="Environmental Hazards"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td><strong>Regulatory/Compliance</strong></td>
                <td><input type="text" class="threat-likelihood" data-category="Regulatory/Compliance"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Data Privacy Violations</td>
                <td><input type="text" class="threat-likelihood" data-category="Data Privacy Violations"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Regulatory Non-compliance</td>
                <td><input type="text" class="threat-likelihood" data-category="Regulatory Non-compliance"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Audit Findings</td>
                <td><input type="text" class="threat-likelihood" data-category="Audit Findings"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td><strong>Third-party Risks</strong></td>
                <td><input type="text" class="threat-likelihood" data-category="Third-party Risks"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Vendor/Supplier Failure</td>
                <td><input type="text" class="threat-likelihood" data-category="Vendor/Supplier Failure"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Cloud Service Disruption</td>
                <td><input type="text" class="threat-likelihood" data-category="Cloud Service Disruption"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
            <tr>
                <td>• Supply Chain Compromise</td>
                <td><input type="text" class="threat-likelihood" data-category="Supply Chain Compromise"></td>
                <td><input type="text" class="threat-notes"></td>
            </tr>
        </table>

        <h3>Emerging Threats
            <button id="suggestEmergingThreatsBtn" class="llm-button">✨ Suggest Emerging Threats</button>
            <span id="emergingThreatsLoading" class="loading-indicator" style="display:none;">Loading...</span>
        </h3>
        <div class="form-row">
            <label>1.</label>
            <input type="text" id="emergingThreat1" style="width: 500px;">
        </div>
        <div class="form-row">
            <label>2.</label>
            <input type="text" id="emergingThreat2" style="width: 500px;">
        </div>
        <div class="form-row">
            <label>3.</label>
            <input type="text" id="emergingThreat3" style="width: 500px;">
        </div>
        <div id="emergingThreatsResponse" class="llm-response" style="display:none;"></div>
    </div>

    <div class="section page-break">
        <h2>Section 4: Vulnerability Assessment</h2>

        <h3>Technical Vulnerabilities</h3>
        <div class="form-row">
            <label>Last scan date:</label>
            <input type="date" id="lastScanDate">
        </div>
        <div class="form-row">
            <label>Critical vulnerabilities:</label>
            <input type="text" id="criticalVuln" style="width: 100px;">
            <label>High vulnerabilities:</label>
            <input type="text" id="highVuln" style="width: 100px;">
            <label>Medium vulnerabilities:</label>
            <input type="text" id="mediumVuln" style="width: 100px;">
            <label>Low vulnerabilities:</label>
            <input type="text" id="lowVuln" style="width: 100px;">
        </div>

        <h3>Security Control Gaps</h3>
        <table>
            <tr>
                <th>Control Area</th>
                <th>Current State</th>
                <th>Gap Identified</th>
                <th>Severity</th>
            </tr>
            <tr>
                <td>Access Control</td>
                <td><input type="text" class="control-state"></td>
                <td><input type="text" class="gap-identified"></td>
                <td><input type="text" class="severity"></td>
            </tr>
            <tr>
                <td>Authentication</td>
                <td><input type="text" class="control-state"></td>
                <td><input type="text" class="gap-identified"></td>
                <td><input type="text" class="severity"></td>
            </tr>
            <tr>
                <td>Encryption</td>
                <td><input type="text" class="control-state"></td>
                <td><input type="text" class="gap-identified"></td>
                <td><input type="text" class="severity"></td>
            </tr>
            <tr>
                <td>Network Security</td>
                <td><input type="text" class="control-state"></td>
                <td><input type="text" class="gap-identified"></td>
                <td><input type="text" class="severity"></td>
            </tr>
            <tr>
                <td>Endpoint Protection</td>
                <td><input type="text" class="control-state"></td>
                <td><input type="text" class="gap-identified"></td>
                <td><input type="text" class="severity"></td>
            </tr>
            <tr>
                <td>Patch Management</td>
                <td><input type="text" class="control-state"></td>
                <td><input type="text" class="gap-identified"></td>
                <td><input type="text" class="severity"></td>
            </tr>
            <tr>
                <td>Backup/Recovery</td>
                <td><input type="text" class="control-state"></td>
                <td><input type="text" class="gap-identified"></td>
                <td><input type="text" class="severity"></td>
            </tr>
            <tr>
                <td>Monitoring/Logging</td>
                <td><input type="text" class="control-state"></td>
                <td><input type="text" class="gap-identified"></td>
                <td><input type="text" class="severity"></td>
            </tr>
            <tr>
                <td>Incident Response</td>
                <td><input type="text" class="control-state"></td>
                <td><input type="text" class="gap-identified"></td>
                <td><input type="text" class="severity"></td>
            </tr>
            <tr>
                <td>Physical Security</td>
                <td><input type="text" class="control-state"></td>
                <td><input type="text" class="gap-identified"></td>
                <td><input type="text" class="severity"></td>
            </tr>
        </table>

        <h3>Compliance Vulnerabilities</h3>
        <div class="form-row">
            <label>Regulatory Requirements:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="gdpr">
                    <label for="gdpr">GDPR</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="hipaa">
                    <label for="hipaa">HIPAA</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="sox">
                    <label for="sox">SOX</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="pci">
                    <label for="pci">PCI DSS</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="iso">
                    <label for="iso">ISO 27001</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="nist">
                    <label for="nist">NIST Framework</label>
                </div>
            </div>
        </div>

        <div class="form-row">
            <label>Compliance Gaps Identified:</label>
        </div>
        <div class="form-row">
            <label>1.</label>
            <input type="text" id="complianceGap1" style="width: 500px;">
        </div>
        <div class="form-row">
            <label>2.</label>
            <input type="text" id="complianceGap2" style="width: 500px;">
        </div>
        <div class="form-row">
            <label>3.</label>
            <input type="text" id="complianceGap3" style="width: 500px;">
        </div>
    </div>

    <div class="section page-break">
        <h2>Section 5: Risk Analysis</h2>

        <h3>Risk Scenarios</h3>
        <p><strong>Risk ID:</strong> R001</p>
        <div class="form-row">
            <label>Risk Description:</label>
            <input type="text" id="riskDescription" style="width: 400px;">
            <button id="generateRiskDescriptionBtn" class="llm-button">✨ Generate Risk Description</button>
            <span id="riskDescriptionLoading" class="loading-indicator" style="display:none;">Loading...</span>
        </div>
        <div id="riskDescriptionResponse" class="llm-response" style="display:none;"></div>
        <div class="form-row">
            <label>Threat Source:</label>
            <input type="text" id="threatSource" style="width: 200px;">
            <label>Vulnerability Exploited:</label>
            <input type="text" id="vulnerabilityExploited" style="width: 200px;">
        </div>
        <div class="form-row">
            <label>Asset at Risk:</label>
            <input type="text" id="assetAtRisk" style="width: 300px;">
        </div>

        <h3>Impact Assessment</h3>
        <div class="form-row">
            <label>Confidentiality Impact:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="conf_none">
                    <label for="conf_none">None</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="conf_low">
                    <label for="conf_low">Low</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="conf_medium">
                    <label for="conf_medium">Medium</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="conf_high">
                    <label for="conf_high">High</label>
                </div>
            </div>
        </div>

        <div class="form-row">
            <label>Integrity Impact:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="int_none">
                    <label for="int_none">None</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="int_low">
                    <label for="int_low">Low</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="int_medium">
                    <label for="int_medium">Medium</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="int_high">
                    <label for="int_high">High</label>
                </div>
            </div>
        </div>

        <div class="form-row">
            <label>Availability Impact:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="avail_none">
                    <label for="avail_none">None</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="avail_low">
                    <label for="avail_low">Low</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="avail_medium">
                    <label for="avail_medium">Medium</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="avail_high">
                    <label for="avail_high">High</label>
                </div>
            </div>
        </div>

        <h3>Business Impact</h3>
        <div class="form-row">
            <label>Financial Loss:</label>
            <input type="text" id="financialLoss" style="width: 150px;">
            <label>Operational Disruption:</label>
            <input type="text" id="operationalDisruption" style="width: 200px;">
        </div>
        <div class="form-row">
            <label>Reputational Damage:</label>
            <input type="text" id="reputationalDamage" style="width: 200px;">
            <label>Regulatory Penalties:</label>
            <input type="text" id="regulatoryPenalties" style="width: 200px;">
        </div>
        <div class="form-row">
            <label>Customer Impact:</label>
            <input type="text" id="customerImpact" style="width: 300px;">
        </div>

        <h3>Likelihood Assessment</h3>
        <div class="checkbox-group">
            <div class="checkbox-item">
                <input type="checkbox" id="like_vlow">
                <label for="like_vlow">Very Low (1)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="like_low">
                <label for="like_low">Low (2)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="like_medium">
                <label for="like_medium">Medium (3)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="like_high">
                <label for="like_high">High (4)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="like_vhigh">
                <label for="like_vhigh">Very High (5)</label>
            </div>
        </div>

        <h3>Risk Score Calculation</h3>
        <div class="form-row">
            <label>Impact Score (1-5):</label>
            <input type="text" id="impactScore" style="width: 50px;">
            <label>Likelihood Score (1-5):</label>
            <input type="text" id="likelihoodScore" style="width: 50px;">
            <label><strong>Overall Risk Score:</strong></label>
            <input type="text" id="overallRiskScore" style="width: 50px;">
        </div>

        <div class="form-row">
            <label>Risk Level:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="risk_low">
                    <label for="risk_low">Low (1-6)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="risk_medium">
                    <label for="risk_medium">Medium (8-12)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="risk_high">
                    <label for="risk_high">High (15-20)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="risk_critical">
                    <label for="risk_critical">Critical (25)</label>
                </div>
            </div>
        </div>
    </div>

    <div class="section page-break">
        <h2>Section 6: Risk Prioritization Matrix</h2>

        <table>
            <tr>
                <th>Risk ID</th>
                <th>Risk Description</th>
                <th>Impact</th>
                <th>Likelihood</th>
                <th>Risk Score</th>
                <th>Risk Level</th>
                <th>Priority</th>
            </tr>
            <tr>
                <td>R001</td>
                <td><input type="text" class="risk-matrix-desc"></td>
                <td><input type="text" class="risk-matrix-impact"></td>
                <td><input type="text" class="risk-matrix-likelihood"></td>
                <td><input type="text" class="risk-matrix-score"></td>
                <td><input type="text" class="risk-matrix-level"></td>
                <td><input type="text" class="risk-matrix-priority"></td>
            </tr>
            <tr>
                <td>R002</td>
                <td><input type="text" class="risk-matrix-desc"></td>
                <td><input type="text" class="risk-matrix-impact"></td>
                <td><input type="text" class="risk-matrix-likelihood"></td>
                <td><input type="text" class="risk-matrix-score"></td>
                <td><input type="text" class="risk-matrix-level"></td>
                <td><input type="text" class="risk-matrix-priority"></td>
            </tr>
            <tr>
                <td>R003</td>
                <td><input type="text" class="risk-matrix-desc"></td>
                <td><input type="text" class="risk-matrix-impact"></td>
                <td><input type="text" class="risk-matrix-likelihood"></td>
                <td><input type="text" class="risk-matrix-score"></td>
                <td><input type="text" class="risk-matrix-level"></td>
                <td><input type="text" class="risk-matrix-priority"></td>
            </tr>
            <tr>
                <td>R004</td>
                <td><input type="text" class="risk-matrix-desc"></td>
                <td><input type="text" class="risk-matrix-impact"></td>
                <td><input type="text" class="risk-matrix-likelihood"></td>
                <td><input type="text" class="risk-matrix-score"></td>
                <td><input type="text" class="risk-matrix-level"></td>
                <td><input type="text" class="risk-matrix-priority"></td>
            </tr>
            <tr>
                <td>R005</td>
                <td><input type="text" class="risk-matrix-desc"></td>
                <td><input type="text" class="risk-matrix-impact"></td>
                <td><input type="text" class="risk-matrix-likelihood"></td>
                <td><input type="text" class="risk-matrix-score"></td>
                <td><input type="text" class="risk-matrix-level"></td>
                <td><input type="text" class="risk-matrix-priority"></td>
            </tr>
        </table>
    </div>

    <div class="section page-break">
        <h2>Section 7: Existing Controls Assessment</h2>

        <h3>Current Security Controls</h3>
        <table>
            <tr>
                <th>Control Type</th>
                <th>Control Description</th>
                <th>Implementation Status</th>
                <th>Effectiveness</th>
                <th>Notes</th>
            </tr>
            <tr>
                <td>Preventive</td>
                <td><input type="text" class="control-desc"></td>
                <td>☐ Implemented ☐ Partial ☐ Planned</td>
                <td>☐ Effective ☐ Partially ☐ Ineffective</td>
                <td><input type="text" class="control-notes"></td>
            </tr>
            <tr>
                <td>Detective</td>
                <td><input type="text" class="control-desc"></td>
                <td>☐ Implemented ☐ Partial ☐ Planned</td>
                <td>☐ Effective ☐ Partially ☐ Ineffective</td>
                <td><input type="text" class="control-notes"></td>
            </tr>
            <tr>
                <td>Corrective</td>
                <td><input type="text" class="control-desc"></td>
                <td>☐ Implemented ☐ Partial ☐ Planned</td>
                <td>☐ Effective ☐ Partially ☐ Ineffective</td>
                <td><input type="text" class="control-notes"></td>
            </tr>
            <tr>
                <td>Compensating</td>
                <td><input type="text" class="control-desc"></td>
                <td>☐ Implemented ☐ Partial ☐ Planned</td>
                <td>☐ Effective ☐ Partially ☐ Ineffective</td>
                <td><input type="text" class="control-notes"></td>
            </tr>
        </table>

        <h3>Control Effectiveness Assessment</h3>
        <div class="form-row">
            <label>Overall Control Maturity Level:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="level1">
                    <label for="level1">Level 1 - Initial/Ad hoc</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="level2">
                    <label for="level2">Level 2 - Managed</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="level3">
                    <label for="level3">Level 3 - Defined</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="level4">
                    <label for="level4">Level 4 - Quantitatively Managed</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="level5">
                    <label for="level5">Level 5 - Optimized</label>
                </div>
            </div>
        </div>
    </div>

    <div class="section page-break">
        <h2>Section 8: Risk Treatment Plan</h2>

        <h3>Risk Treatment Options</h3>
        <p><strong>Risk ID:</strong> R001</p>
        <div class="form-row">
            <label>Treatment Strategy:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="accept">
                    <label for="accept">Accept - Risk within acceptable tolerance</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="avoid">
                    <label for="avoid">Avoid - Eliminate risk source/activity</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="mitigate">
                    <label for="mitigate">Mitigate - Reduce likelihood or impact</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="transfer">
                    <label for="transfer">Transfer - Share/transfer risk to third party</label>
                </div>
            </div>
        </div>

        <h3>Recommended Actions</h3>
        <div class="form-row">
            <label>1.</label>
            <input type="text" id="recAction1" style="width: 500px;">
        </div>
        <div class="form-row">
            <label>2.</label>
            <input type="text" id="recAction2" style="width: 500px;">
        </div>
        <div class="form-row">
            <label>3.</label>
            <input type="text" id="recAction3" style="width: 500px;">
        </div>

        <h3>Implementation Details</h3>
        <div class="form-row">
            <label>Responsible Party:</label>
            <input type="text" id="responsibleParty" style="width: 200px;">
            <label>Target Completion Date:</label>
            <input type="date" id="targetCompletionDate">
        </div>
        <div class="form-row">
            <label>Required Resources:</label>
            <input type="text" id="requiredResources" style="width: 300px;">
        </div>
        <div class="form-row">
            <label>Success Criteria:</label>
            <input type="text" id="successCriteria" style="width: 400px;">
        </div>
        <div class="form-row">
            <label>Residual Risk Level:</label>
            <input type="text" id="residualRiskLevel" style="width: 150px;">
        </div>
    </div>

    <div class="section page-break">
        <h2>Section 9: Business Continuity Impact</h2>

        <h3>Business Process Dependencies</h3>
        <div class="form-row">
            <label>Critical Business Processes Affected:</label>
        </div>
        <div class="form-row">
            <label>1.</label>
            <input type="text" id="bizProcess1" style="width: 500px;">
        </div>
        <div class="form-row">
            <label>2.</label>
            <input type="text" id="bizProcess2" style="width: 500px;">
        </div>
        <div class="form-row">
            <label>3.</label>
            <input type="text" id="bizProcess3" style="width: 500px;">
        </div>

        <div class="form-row">
            <label>Recovery Time Objectives (RTO):</label>
            <input type="text" id="rto" style="width: 150px;">
            <label>Recovery Point Objectives (RPO):</label>
            <input type="text" id="rpo" style="width: 150px;">
        </div>
        <div class="form-row">
            <label>Maximum Tolerable Downtime:</label>
            <input type="text" id="mtd" style="width: 200px;">
        </div>

        <h3>Disaster Recovery Considerations</h3>
        <div class="form-row">
            <label>Backup Systems Available:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="backup_yes">
                    <label for="backup_yes">Yes</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="backup_no">
                    <label for="backup_no">No</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="backup_partial">
                    <label for="backup_partial">Partial</label>
                </div>
            </div>
        </div>

        <div class="form-row">
            <label>Alternate Site/Facilities:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="alt_yes">
                    <label for="alt_yes">Yes</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="alt_no">
                    <label for="alt_no">No</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="alt_na">
                    <label for="alt_na">N/A</label>
                </div>
            </div>
        </div>

        <div class="form-row">
            <label>Communication Plan:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="comm_yes">
                    <label for="comm_yes">Yes</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="comm_no">
                    <label for="comm_no">No</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="comm_update">
                    <label for="comm_update">Needs Update</label>
                </div>
            </div>
        </div>

        <div class="form-row">
            <label>Staff Training:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="train_current">
                    <label for="train_current">Current</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="train_update">
                    <label for="train_update">Needs Update</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="train_required">
                    <label for="train_required">Required</label>
                </div>
            </div>
        </div>
    </div>

    <div class="section page-break">
        <h2>Section 10: Monitoring and Metrics</h2>

        <h3>Key Risk Indicators (KRIs)</h3>
        <table>
            <tr>
                <th>KRI</th>
                <th>Current Value</th>
                <th>Threshold</th>
                <th>Frequency</th>
                <th>Owner</th>
            </tr>
            <tr>
                <td><input type="text" class="kri-name"></td>
                <td><input type="text" class="kri-value"></td>
                <td><input type="text" class="kri-threshold"></td>
                <td><input type="text" class="kri-frequency"></td>
                <td><input type="text" class="kri-owner"></td>
            </tr>
            <tr>
                <td><input type="text" class="kri-name"></td>
                <td><input type="text" class="kri-value"></td>
                <td><input type="text" class="kri-threshold"></td>
                <td><input type="text" class="kri-frequency"></td>
                <td><input type="text" class="kri-owner"></td>
            </tr>
            <tr>
                <td><input type="text" class="kri-name"></td>
                <td><input type="text" class="kri-value"></td>
                <td><input type="text" class="kri-threshold"></td>
                <td><input type="text" class="kri-frequency"></td>
                <td><input type="text" class="kri-owner"></td>
            </tr>
            <tr>
                <td><input type="text" class="kri-name"></td>
                <td><input type="text" class="kri-value"></td>
                <td><input type="text" class="kri-threshold"></td>
                <td><input type="text" class="kri-frequency"></td>
                <td><input type="text" class="kri-owner"></td>
            </tr>
        </table>

        <h3>Monitoring Plan</h3>
        <div class="form-row">
            <label>Review Frequency:</label>
            <input type="text" id="reviewFrequency" style="width: 200px;">
            <label>Reporting Schedule:</label>
            <input type="text" id="reportingSchedule" style="width: 200px;">
        </div>
        <div class="form-row">
            <label>Escalation Triggers:</label>
            <input type="text" id="escalationTriggers" style="width: 400px;">
        </div>
        <div class="form-row">
            <label>Communication Plan:</label>
            <input type="text" id="communicationPlan" style="width: 400px;">
        </div>
    </div>

    <div class="section page-break">
        <h2>Section 11: Approval and Sign-off</h2>

        <h3>Assessment Team Approval</h3>
        <div class="signature-section">
            <div class="signature-box">
                <div class="name">Lead Assessor: _________________________</div>
                <div>Signature: _________________________</div>
                <div class="date">Date: _________________________</div>
            </div>
            <div class="signature-box">
                <div class="name">Risk Manager: _________________________</div>
                <div>Signature: _________________________</div>
                <div class="date">Date: _________________________</div>
            </div>
        </div>

        <h3>Business Unit Approval</h3>
        <div class="signature-section">
            <div class="signature-box">
                <div class="name">Business Unit Manager: _________________________</div>
                <div>Signature: _________________________</div>
                <div class="date">Date: _________________________</div>
            </div>
            <div class="signature-box">
                <div class="name">IT Security Officer: _________________________</div>
                <div>Signature: _________________________</div>
                <div class="date">Date: _________________________</div>
            </div>
        </div>

        <h3>Executive Approval</h3>
        <div class="signature-section">
            <div class="signature-box">
                <div class="name">Chief Information Officer: _________________________</div>
                <div>Signature: _________________________</div>
                <div class="date">Date: _________________________</div>
            </div>
            <div class="signature-box">
                <div class="name">Chief Risk Officer: _________________________</div>
                <div>Signature: _________________________</div>
                <div class="date">Date: _________________________</div>
            </div>
        </div>
    </div>

    <div class="section page-break">
        <h2>Section 12: Documentation and Records</h2>

        <h3>Supporting Documentation</h3>
        <div class="checkbox-group">
            <div class="checkbox-item">
                <input type="checkbox" id="vuln_scan">
                <label for="vuln_scan">Vulnerability Scan Reports</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="pen_test">
                <label for="pen_test">Penetration Test Results</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="sec_audit">
                <label for="sec_audit">Security Audit Reports</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="comp_assess">
                <label for="comp_assess">Compliance Assessment Reports</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="bia">
                <label for="bia">Business Impact Analysis</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="asset_inv">
                <label for="asset_inv">Asset Inventory</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="net_diagram">
                <label for="net_diagram">Network Diagrams</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="sys_arch">
                <label for="sys_arch">System Architecture Documents</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="incident_rep">
                <label for="incident_rep">Incident Reports</label>
            </div>
        </div>

        <h3>Record Retention</h3>
        <div class="form-row">
            <label>Document Storage Location:</label>
            <input type="text" id="docStorageLocation" style="width: 300px;">
        </div>
        <div class="form-row">
            <label>Access Controls:</label>
            <input type="text" id="accessControls" style="width: 300px;">
        </div>
        <div class="form-row">
            <label>Retention Period:</label>
            <input type="text" id="retentionPeriod" style="width: 200px;">
            <label>Disposal Method:</label>
            <input type="text" id="disposalMethod" style="width: 200px;">
        </div>
    </div>

    <div class="section" style="text-align: center; margin-top: 40px; border-top: 2px solid #2c5aa0; padding-top: 20px;">
        <p><strong>Form Version:</strong> 1.0 &nbsp;&nbsp;|&nbsp;&nbsp; <strong>Effective Date:</strong> _____________ &nbsp;&nbsp;|&nbsp;&nbsp; <strong>Next Review Date:</strong> _____________</p>
        <p><strong>Document Owner:</strong> IT Risk Management &nbsp;&nbsp;|&nbsp;&nbsp; <strong>Classification:</strong> Internal Use Only</p>
    </div>

    <div class="footer no-print">
        <p>IT Risk Assessment Form - Enterprise Risk Management | Page <span id="page-number"></span></p>
    </div>

    <script>
        // Add page numbering for print
        window.addEventListener('beforeprint', function() {
            const pageNumber = document.getElementById('page-number');
            if (pageNumber) {
                pageNumber.textContent = '1'; /* You might want to dynamically calculate page numbers for multi-page forms */
            }
        });

        // Function to call Gemini API
        async function callGeminiAPI(prompt, outputElementId, loadingElementId) {
            const outputElement = document.getElementById(outputElementId);
            const loadingElement = document.getElementById(loadingElementId);

            outputElement.style.display = 'none';
            loadingElement.style.display = 'inline-block';
            outputElement.textContent = ''; // Clear previous response

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will automatically provide the API key
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    outputElement.textContent = text;
                    outputElement.style.display = 'block';
                } else {
                    outputElement.textContent = 'Error: Could not get a valid response from the API.';
                    outputElement.style.display = 'block';
                    console.error('Gemini API response structure unexpected:', result);
                }
            } catch (error) {
                outputElement.textContent = `Error: ${error.message}`;
                outputElement.style.display = 'block';
                console.error('Error calling Gemini API:', error);
            } finally {
                loadingElement.style.display = 'none';
            }
        }

        // Event listener for "Suggest Emerging Threats" button
        document.getElementById('suggestEmergingThreatsBtn').addEventListener('click', async () => {
            const threatCategories = Array.from(document.querySelectorAll('.threat-likelihood'))
                                        .map(input => input.dataset.category)
                                        .filter(category => category && !category.startsWith('•')); // Get main categories

            let prompt = `Suggest three distinct and concise emerging IT threats. Focus on areas like: ${threatCategories.join(', ')}. Format them as a numbered list.`;

            await callGeminiAPI(prompt, 'emergingThreatsResponse', 'emergingThreatsLoading');

            // Optional: Populate the input fields if the response is a numbered list
            const responseText = document.getElementById('emergingThreatsResponse').textContent;
            const threats = responseText.split('\n').filter(line => line.match(/^\d+\./));
            if (threats.length > 0) document.getElementById('emergingThreat1').value = threats[0].replace(/^\d+\.\s*/, '');
            if (threats.length > 1) document.getElementById('emergingThreat2').value = threats[1].replace(/^\d+\.\s*/, '');
            if (threats.length > 2) document.getElementById('emergingThreat3').value = threats[2].replace(/^\d+\.\s*/, '');
        });

        // Event listener for "Generate Risk Description" button
        document.getElementById('generateRiskDescriptionBtn').addEventListener('click', async () => {
            const threatSource = document.getElementById('threatSource').value;
            const vulnerabilityExploited = document.getElementById('vulnerabilityExploited').value;
            const assetAtRisk = document.getElementById('assetAtRisk').value;

            if (!threatSource && !vulnerabilityExploited && !assetAtRisk) {
                document.getElementById('riskDescriptionResponse').textContent = 'Please fill in Threat Source, Vulnerability Exploited, or Asset at Risk to generate a description.';
                document.getElementById('riskDescriptionResponse').style.display = 'block';
                return;
            }

            let prompt = `Generate a concise IT risk description based on the following information:`;
            if (threatSource) prompt += ` Threat Source: ${threatSource}.`;
            if (vulnerabilityExploited) prompt += ` Vulnerability Exploited: ${vulnerabilityExploited}.`;
            if (assetAtRisk) prompt += ` Asset at Risk: ${assetAtRisk}.`;
            prompt += ` The description should be a single sentence.`;

            await callGeminiAPI(prompt, 'riskDescriptionResponse', 'riskDescriptionLoading');

            // Optional: Populate the input field with the generated description
            document.getElementById('riskDescription').value = document.getElementById('riskDescriptionResponse').textContent;
        });
    </script>
</body>
</html>
